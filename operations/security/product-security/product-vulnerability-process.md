# Product Vulnerability process

## Overview
This document aims to provide guidance on the handling of product vulnerabilities. 
It should explain to any of the relevant stakeholders all parts of the process and provide background information and 
definitions for the daily usage.

## Goals
Establish and document a way of working that ensures:

* Vulnerabilities are triaged efficiently and quickly 
* All parties are aligned around ownership and expectations
* Patch releases are available within the agreed SLAs

## Scope
This process covers any vulnerabilities found in officially published Mattermost products that were either found 
internally, reported to us by a customer, or come in through the bug bounty program or via another third party.

Infrastructure vulnerabilities are explicitly out of scope for this process. Vulnerability management, as it relates to infrastructure, is owned by the Security Operations Team.

## Process Definitions

### Responsible Parties
- Product Security Team: Process Ownership; Vulnerability Owner
- Development Team: Vulnerability Remediation
- Release Manager: Release Planning
- Build Team: Build Process

### Vulnerability Sources
Vulnerabilities are reported from a variety of sources that are explained below.

#### Internal Finding
Vulnerability has been discovered by the internal security, development, or QA team. Additional possibility is finding 
through internal security automation such as Dependency-Track or CodeQL.

#### Responsible Disclosure
Vulnerability has been reported through our [responsible disclosure program](https://mattermost.com/security-vulnerability-report/).

#### Bug Bounty Program
Vulnerability has been reported through our [Bug Bounty program running on HackerOne](https://hackerone.com/mattermost?type=team).

#### Customer Report
Vulnerability has been reported from customers as part of an internal audit or on-going operations.

#### Public Leak
Vulnerability has not been officially reported, but released to the public without any notice. It is possible that it 
can contain reproduction steps or not.

### Vulnerability Severity
Vulnerabilities must be scored according to the Common Vulnerability Scoring System Version 3.1 (CVSS 3.1). The CVSS 
is an industry-wide accepted standard to determine the impact of vulnerabilities in software products and takes impacts 
such as attack vector, complexity, user interaction, scope, and various other components into consideration.

FIRST provides a CVSS calculator at the following URL: https://www.first.org/cvss/calculator/3.1

The CVSS 3.1 provides a textural representation of the severity score in Section 5 of the Specification Document. The 
mapping is included below:

<table>
  <thead>
    <tr>
      <th style="text-align:left">Rating</th>
      <th style="text-align:left">CVSS Score</th>
    </tr>
  </thead>
  <tbody>
        <tr>
            <td>None</td>
            <td>0.0</td>
        </tr>
        <tr>
            <td>Low</td>
            <td>0.1 - 3.9</td>
        </tr>
        <tr>
            <td>Medium</td>
            <td>4.0 - 6.9</td>
        </tr>
        <tr>
            <td>High</td>
            <td>7.0 - 8.9</td>
        </tr>
        <tr>
            <td>Critical</td>
            <td>9.0 - 10.0</td>
        </tr>
  </tbody>
</table>

### Remediation SLAs

(INTERNAL - TBD to Publish)

### Issue Types
Vulnerabilities must be assigned one of the following vulnerability types:
- Authorization
- Reducing Attack Surface
- XSS
- Input Validation
- Phishing
- Injection
- Information Disclosure
- DOS
- Authentication
- CSRF
- Misconfiguration
- 3rd Party Library
- Remote Code Execution

If no fitting category can be found, the security engineer must request the inclusion of a new type from the product 
security team lead.

### Backport Policy

#### Vulnerabilities with Low Score to Medium Score:
- Upcoming Release
- Extended Support Release

#### Vulnerabilities with High to Critical Score:
- Upcoming Release
- Extended Support Release
- Last 3 Releases

## Process Steps

### Report
Vulnerability reports are received from internal or external parties via one of the methods outlined above. The Product 
Security Team must acknowledge to the reporter that it received the report within 24h on business days and will investigate 
whether it’s a valid issue. If the vulnerability was published on a news site/blog/etc. and is considered a public leak 
the marketing team should be notified to coordinate on the response in the respective Mattermost channel with a “@channel” mention.

After the report was received, a “Security Vulnerability” ticket must be created in the Jira ticket that contains the 
following information:

* Title
* Description
* Category [If possible]
* Reporter
* Source

The security engineer that acknowledges the initial report must create a Mattermost Playbook Run using the "Security 
Vulnerability Playbook" and follow the process steps documented to continue with the Triage step. The playbook links to
the Jira ticket created above, ensures the right process steps are completed, and informs relevant parties.

###  Triage
After a vulnerability report was acknowledged it must be confirmed whether it is a valid finding within 72h of receiving 
it on business days.  The security engineer should determine:

* Is the report a duplicate of a previous or current report from another reporter?
* Does the report have a security impact?
* Can the report be reproduced?
* Is the report affecting a component that is in scope?

If not, does the report have an impact on any production infrastructure or systems and thus should be reviewed nevertheless?
After confirming that the report is valid the Product Security Team member can move the report to the next stage, called 
Fix Development and must fill in the following information in the ticket:

* Vulnerability Category
* Security Update Text
* CVSS Score
* Affected Versions

(A vulnerability ID is automatically assigned when a report is moved from “Triage” to “Fix Development”)

If the vulnerability is not confirmed valid or considered a duplicate, the security engineer must notify the reporter 
about the decision. If we don’t consider it a vulnerability, the justification for our decision should be included. The 
ticket should afterwards be closed either as duplicate or as invalid.

If the report is deemed a security improvement (but not vulnerability), a development ticket should be created and the 
security vulnerability ticket closed with the development ticket added as a reference. A report is considered a security 
improvement when it is not exploitable without the presence of any additional vulnerabilities or only increases the 
general security posture.

###  Fix Development
The Product Security Team must open a bug ticket and assign it to the corresponding feature team for the vulnerability 
found. The lead engineer/product manager of the feature team and the release manager should be notified with an 
“@”-mention about the security vulnerability in the Product Security channel and about its severity. The lead engineer 
must acknowledge the report, create a linked development ticket and assign it to an engineer. The lead engineer should 
work together with the product manager on the prioritization of the reported security vulnerability.

The development team is responsible for the development of the fix. The assigned product security engineer is 
responsible to notify the developer teams if an agreed SLAs is at risk for the fix development and document once the 
SLA is broken. Developers should work together with the assigned Product Security Engineer during the fix development 
to clarify questions and mitigation approaches.  After the development team finished the fix development for the current 
version, the fix must be backported to previous releases. This is not the case if:

* The affected feature did not exist in the version in question
* The vulnerability has a low severity

* If in doubt, refer to the Backport Policy section above. After the fix development has finished and has been reviewed 
* by peers, security and QA a new dot release must be prepared.

###  Release Preparation
After reviews have been completed, the developer must notify the Release Manager that a new release version can be cut. 
The release manager must cut a new dot release for all versions that received the security fix and release it. In case 
there are any problems during the release, the build engineering team should be notified to fix potential issues.

Notify parties:
TBD

###  Post Mortem
The release manager must create a draft for the email newsletter. The marketing team must review the draft and send it 
out to all subscribers of the Security Updates mailing list.

The product security engineer must create a post mortem and share it in the Mattermost Playbook run for the Incident.

###  Responsible Disclosure
The release manager must publish 30 days after the release the security update notes for vulnerabilities released. 
The security engineer must prepare all required information and include it in the initial vulnerability ticket.
